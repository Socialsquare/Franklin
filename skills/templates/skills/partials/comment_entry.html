{% load permissionif %}

<div class="comment" style="margin-left:{{ comment.level }}rem;" id="comment-{{comment.id}}">

  <div class="headline">
    <img src="{{ comment.author.getImage }}">
    <h6 class="author">{{ comment.author.username }}</h6><span class="date">{{ comment.created_at }}</span>

    <div class="moderation">
      {# Delete comment button #}
      {% permission request.user has 'skills.delete_comment' of comment %}
      <a href="{% url 'comments-delete' comment.id %}" class="alert adelete" data-dropdown="comment-delete-dropdown-{{comment.id}}">Delete</a>
      {% endpermission %}

      {# Flag comment button #}
      <a href="{% url 'comments-flag' comment.id %}" class="flag" data-dropdown="comment-flag-dropdown-{{comment.id}}">Flag comment</a>
      <div id="comment-flag-dropdown-{{comment.id}}" class="f-dropdown" data-dropdown-content>
        <h6>Really flag this comment?</h6>
        <form action="{% url 'comments-flag' comment.id %}" method="post">{% csrf_token %}
          {% if next %}<div><input type="hidden" name="next" value="{{ next }}" id="next" /></div>{% endif %}
          <p class="submit">
            <input type="submit" name="submit" class="button" value="Flag" />
            <a href="{{ comment.get_absolute_url }}" class="button close info">cancel</a>
          </p>
        </form>
      </div>
      <script>
      $('#comment-flag-dropdown-{{comment.id}} a.close').click(function(event) {
        event.preventDefault();
        $('#comment-flag-dropdown-{{comment.id}}').foundation('dropdown', 'close', $('#comment-flag-dropdown-{{comment.id}}'));
      });
      $("#comment-flag-from-{{comment.id}}").ajaxForm({
        success: function() {
          $("#comment-{{comment.id}}").remove();
        }
      });
      </script>
    </div>
  </div>

    {% if comment.is_deleted %}
    <span class="icon block"></span>
    {% else %}
    <p class="content">{{ comment.text }}</p>
    {% endif %}


    {# Reply to comment button #}
    {% if comment.allow_thread %}<a href="{% url 'skills:comment_post' %}" data-project-pk="{{ project.pk }}" data-parent-pk="{{ comment.pk }}" class="reply">Reply</a>{% endif %}
  <!-- </div> -->


</div>
