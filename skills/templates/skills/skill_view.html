{% extends 'base.html' %}

{% load permissionif %}
{% load user_skills %}
{% load staticfiles %}

{% block body-classes %}skill-view{% endblock %}

{% block content %}
<div class="page-buttons">
  {# Mark as public #}
  {% permission request.user has 'skill.publicize' %}
    {% if skill.is_public %}
      <a href="{% url 'skills:skill_publicize' skill.id %}" class="button info admin-button">Hide this skill</a>
    {% else %}
      <a href="{% url 'skills:skill_publicize' skill.id %}" class="button success admin-button">Make this skill public</a>
    {% endif %}
  {% endpermission %}

  {# Edit skill button #}
  {% permission request.user has 'skill.edit' %}
    <a href="{% url 'skills:skill_edit' skill.id %}" class="button info admin-button">Edit skill</a>
  {% endpermission %}

  {# Delete skill button #}
  {% permission request.user has 'skill.delete' %}
    <a href="{% url 'skills:skill_delete' skill.id %}" class="button admin-button">Delete skill</a>
  {% endpermission %}
</div>
<div id="skill-cover">
  <div class="skill-headline">
    {% if skill in request.user.skills_completed.all %}
    <img src="{% static 'images/skill-flag-red.png' %}" alt="Skill image">
    {% else %}
    <img src="{% static 'images/skill-flag-gray.png' %}" alt="Skill image">
    {% endif %}
    <div class="text-container">
    <h1>{{skill.name}}</h1>
  </div>
  </div>
  <p class="skill-description">{{skill.description|linebreaksbr}}</p>
  <div class="start-row">
  {% if request.user.is_authenticated %}
    {# {% if skill in request.user.skills_in_progress.all %} #}
    {% if request.user|is_taking_skill:skill %}
      <a class="button small begin" href="{% url 'skills:skill_stop' skill.id %}">Stop taking this skill</a>
    {% else %}
      <a class="button small begin" href="{% url 'skills:skill_start' skill.id %}">Start this skill</a>
    {% endif %}
  {% else %}
    <a class="button small begin" href="{# url 'login' #}">Sign up to start this skill</a>
  {% endif %}
    <div class="metadata">
      <span class="trainingbit-count">{{ skill.trainingbits.count }} Training Bits</span>
      <!-- <br> -->
      {% include 'skills/partials/like_counter.html' with object=skill %}
      <span class="icon users red"></span><span class="count">{{ skill.users_completed.count }}</span>
      {% include 'skills/partials/like_button.html' with object=skill %}
    </div>
  </div>

</div>

<hr>
{% include 'partials/trainingbits_grid.html' with get_query=skill_id_get_query %}
{% endblock %}

{% block fat_footer %}
{% include 'partials/fat_footer.html' %}
{% endblock %}
