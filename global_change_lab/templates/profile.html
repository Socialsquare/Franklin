{% extends 'base.html' %}


{% load static %}
{% load inplace_edit %}


{% block scripts %}
<script src="{% static 'global_change_lab/js/fileupload.min.js' %}"></script>
{% endblock %}

{% block body-classes %}user-profile{% endblock %}

{% block content %}
<div class="page-buttons">

  {# Upgrade user button (to trainer) #}
  {% if request.user.is_admin %}
    {% if not profile_user.is_trainer and not profile_user.is_admin %}
    <a href="{% url 'user_upgrade_to_trainer' profile_user.id %}" class="button admin-button success">Upgrade to trainer</a>
    {% endif %}
  {% endif %}

  {# Delete user button #}
  {% if request.user.is_admin %}
    <a href="{% url 'user_delete' profile_user.id %}" class="button admin-button hard-delete" data-dynamic="false">Delete</a>
  {% endif %}

  {# Edit profile user button #}
  {% if request.user == profile_user or request.user.is_admin %}
    <a href="#" class="button" data-reveal-id="edit-modal">Edit profile</a>
  {% endif %}
</div>

<div id="edit-modal" class="reveal-modal small" data-reveal>
  {% include 'partials/user_info_form.html' with has_delete=True %}

  <a class="close-reveal-modal">&#215;</a>
</div>



<div class="row" id="profile-bar">
  <div class="large-2 columns">
    <div id="profile-picture">
      <img src="{{ profile_user.getImage }}" class="profile-picture">
    </div>
  </div>
  <div class="large-10 columns">
    <h1>{{ profile_user.username }}</h1>
      {% if profile_user == request.user %}
    <p class="description inplaceedit">
        {% inplace_edit 'profile_user.description' edit_empty_value="Write about your self here" %}
      {% else %}
    <p class="description">
        {{ profile_user.description }}
      {% endif %}
    </p>
  </div>
</div>

{% if own_profile %}
<div>
  <h1>Your progress</h1>
  <hr class="large">

  <div class="columns medium-4 skill-progress">
    <h6 class="progress-small-headline">Skills you are working on</h6><br>

    {# {% for skill, percentage in skills_in_progress_w_percentage %} #}
    {% if skills_in_progress %}
    {% for skill in skills_in_progress %}
    <div class="row">
      <div class="columns medium-6">
        <a href="{% url 'skills:skill_view' skill.id %}">
          <h6>{{ skill.name }}</h6>
        </a>
      </div>
      <div class="columns medium-6">
          <div class="progress success round">
            <span class="meter" style="width: {{ skill.percentage }}%"></span>
          </div>
      </div>
    </div>
    {% endfor %}
    {% else %}
      <div class="empty-message"><div>Not doing anything right now</div></div>
    {% endif %}
  </div>

  <div class="columns medium-8">
    <h6 class="progress-small-headline">Training Bits you haven't finished yet</h6><br>
    {% if trainingbits_in_progress %}
    {% include 'partials/trainingbits_grid.html' with trainingbits=trainingbits_in_progress extra_classes='medium' hide_description=True hide_part_of=True %}
    {% else %}
      <div class="empty-message"><div>Not doing anything right now</div></div>
    {% endif %}
  </div>
</div>
{% endif %}

<hr class="large">

<div>
  <h5>Completed skills</h5>
  {% include 'partials/skills_grid.html' with skills=newest_skills non_shown_skill_count=other_skills_count%}
</div>

<hr>

  <h5>Recently shared</h5>
  {% with hide_user=True %}
  <div class="row">
    <div class="columns medium-4">
    {% for project in project_list0 %}
      {% include 'skills/partials/project_column.html' %}
    {% endfor %}
    </div>
    <div class="columns medium-4">
    {% for project in project_list1 %}
      {% include 'skills/partials/project_column.html' %}
    {% endfor %}
    </div>
    <div class="columns medium-4">
    {% for project in project_list2 %}
      {% include 'skills/partials/project_column.html' %}
    {% endfor %}
    </div>
  </div>

    {% if not hide_user %}
      <div class="profile-image"><span class="icon user"></span></div><a href="{% url 'profile' project.author.id %}"class="author">{{ project.author.username }}</a>
    {% endif %}
  {% endwith %}

{% comment %}
  <div class="row">
    <div class="medium-6 columns">
      <h2>{{ profile_user.username }}'s completed training bits</h2>
      <div class="trainingbit-count">{{ profile_user.trainingbits_completed.count }} in total</div>
      <div id="wordcloud">
        <div class="centering">
          {% for trainingbit in profile_user.trainingbits_completed.all %}
          <a href="{{ trainingbit.get_absolute_url }}">{{ trainingbit.name }}</a>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="medium-6 columns">
      <h2>{{ profile_user.username }}' s skills</h2>
    </div>
  </div>

<hr>

<div class="row">
  <div class="medium-6 columns">
    <h2>{{ profile_user.username }} have shared</h2>
    {% include 'partials/project_list.html' with projects=projects hide_user=True %}
  </div>
  <div class="medium-6 columns">
    <h2>{{ profile_user.username }}'s latest comments</h2>
    {# {% comment %} #}
    <ul>
    {% for comment in profile_user.comment_comments.all %}
    <li>{{ comment.name }}</li>
    {% endfor %}
    {# {% endcomment %} #}
    </ul>
  </div>
</div>

<hr>
{% endcomment %}


{# <dt>Joined on: </dt><dd>{{ profile_user.date_joined }}</dd> #}
{# <dt>Last seen: </dt><dd>{{ profile_user.last_login }}</dd> #}

{# http://stackoverflow.com/questions/8103584/linking-django-comments-with-django-users #}
{# http://stackoverflow.com/questions/5292723/django-retrieve-all-comments-for-a-user #}

{% endblock %}
